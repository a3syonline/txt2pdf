<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DOCX to PDF</title>
    
    <script src="mammoth.browser.min.js"></script>
    <script src="html2pdf.bundle.min.js"></script>

    <style>
        body { font-family: monospace; background: #fff; color: #000; padding: 20px; display: flex; flex-direction: column; align-items: center; line-height: 1.5; }
        .app-box { width: 100%; max-width: 600px; border: 2px solid #000; padding: 25px; }
        #preview-area { border: 1px solid #000; padding: 20px; margin: 20px 0; display: none; text-align: left; background: #fff; }
        button { width: 100%; padding: 15px; background: #000; color: #fff; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #status-bar { background: #f0f0f0; padding: 10px; margin-top: 15px; border-left: 5px solid #000; font-size: 12px; width: 100%; }
        footer { margin-top: 50px; max-width: 600px; text-align: justify; font-size: 13px; border-top: 1px solid #000; padding-top: 20px; }
    </style>
</head>
<body>

    <div class="app-box">
        <strong>DOCX to PDF CONVERTER</strong><br><br>
        <input type="file" id="fileSelector" accept=".docx" style="width: 100%;">
        
        <div id="preview-area"></div>

        <button id="startBtn" disabled>Generate PDF</button>
        <div id="status-bar">> SYSTEM_READY</div>
    </div>

    <footer>
        <strong>HOW TO USE:</strong> Select a .docx file from your device. Wait for the text to appear in the preview box. Once the text is visible, click the "Generate PDF" button. Your file will process and download automatically to your system.
        <br><br>
        <strong>DISCLAIMER:</strong> This tool operates entirely within your local browser environment. No data is transmitted to external servers. Document formatting may vary depending on the complexity of the source file.
    </footer>

    <script>
        const fileSelector = document.getElementById('fileSelector');
        const previewArea = document.getElementById('preview-area');
        const startBtn = document.getElementById('startBtn');
        const statusBar = document.getElementById('status-bar');

        fileSelector.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;

            statusBar.innerText = "> LOADING_FILE...";
            const reader = new FileReader();

            reader.onload = async (event) => {
                try {
                    // Mammoth reads the 'ArrayBuffer' from the file
                    const result = await mammoth.convertToHtml({ arrayBuffer: event.target.result });
                    
                    previewArea.innerHTML = result.value;
                    previewArea.style.display = "block"; // Show it to prevent "Blank PDF"
                    
                    statusBar.innerText = "> READY: " + file.name.toUpperCase();
                    startBtn.disabled = false;
                } catch (err) {
                    statusBar.innerText = "> ERROR: FILE_UNREADABLE (Ensure it is a .docx file)";
                }
            };
            reader.readAsArrayBuffer(file);
        };

        startBtn.onclick = async () => {
            const file = fileSelector.files[0];
            startBtn.disabled = true;
            statusBar.innerText = "> EXECUTING_EXPORT...";

            const options = {
                margin: 0.5,
                filename: file.name.replace(".docx", ".pdf"),
                html2canvas: { scale: 2, scrollY: 0, useCORS: true },
                jsPDF: { unit: 'in', format: 'letter', compress: true },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };

            // 1-second delay to ensure all 40+ items are fully rendered on the page
            setTimeout(async () => {
                try {
                    await html2pdf().set(options).from(previewArea).save();
                    statusBar.innerText = "> COMPLETE. CHECK_DOWNLOAD_FOLDER.";
                } catch (err) {
                    statusBar.innerText = "> ERROR: EXPORT_CRASHED";
                }
                startBtn.disabled = false;
            }, 1000);
        };
    </script>
</body>
</html>
